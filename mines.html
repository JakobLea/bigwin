<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="Logo/Favicon.png">
    <title>Mines Game</title>
    <link rel="stylesheet" href="mines.css">
    <link rel="stylesheet" href="nav.css">
</head>

<script>

    function includeHTML() {
        var z, i, elmnt, file, xhttp;
        /*loop through a collection of all HTML elements:*/
        z = document.getElementsByTagName("*");
        for (i = 0; i < z.length; i++) {
            elmnt = z[i];
            /*search for elements with a certain attribute:*/
            file = elmnt.getAttribute("w3-include-html");
            if (file) {
                /*make an HTTP request using the attribute value as the file name:*/
                xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {
                    if (this.readyState == 4) {
                        if (this.status == 200) { elmnt.innerHTML = this.responseText; }
                        if (this.status == 404) { elmnt.innerHTML = "Page not found."; }
                        /*remove the attribute, and call this function once more:*/
                        elmnt.removeAttribute("w3-include-html");
                        includeHTML();
                    }
                }
                xhttp.open("GET", file, true);
                xhttp.send();
                /*exit the function:*/
                return;
            }
        }
    };

</script>

<body style="background-color:#333333">

    <div w3-include-html="nav.html"></div>

    <!--
    <div class="coin-container">
        <div><label for="coinCount">Coins:</label></div>
        <div id="coinCount">10</div>
    </div>
-->

    <div class="flex-container">

        <div class="selectbox">
            <div><label id="mineCountLabel" for="mineCount">Mines</label></div>
            <div><button id="startButton" onclick="startGame()">Start Game</button></div>
        </div>

        <div class="container" id="container"></div>
        <div></div>
    </div>
    <script>
        const gridSize = 5; // Updated to 5 rows and columns
        const numMines = 1; // Adjust as needed
        let mines = [];
        let points = 0;
        let coins = 10; // Initial number of coins
        let gameStarted = false; // Flag to track if the game has started

        function initializeGame() {
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    const cell = document.createElement("div");
                    cell.classList.add("cell");
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    cell.addEventListener("click", revealCell);
                    document.getElementById("container").appendChild(cell);
                }
            }

            // Place mines randomly
            for (let i = 0; i < numMines; i++) {
                let row, col;
                do {
                    row = Math.floor(Math.random() * gridSize);
                    col = Math.floor(Math.random() * gridSize);
                } while (mines.some(mine => mine.row === row && mine.col === col));
                mines.push({ row, col });
            }
        }

        function startGame() {
            if (!gameStarted && coins > 0) {
                coins--; // Deduct one coin to start the game
                document.getElementById("coinCount").textContent = coins;
                gameStarted = true; // Set the game as started
                enableCells(); // Enable the cells for gameplay
            } else if (gameStarted) {
                alert("You've already started the game!");
            } else {
                alert("You don't have enough coins to start. Please buy more coins.");
            }
        }

        function enableCells() {
            const cells = document.querySelectorAll(".cell");
            cells.forEach(cell => {
                cell.classList.add("enabled");
            });
            document.getElementById("startButton").disabled = true; // Disable the button during gameplay
        }



        function revealCell(event) {
            if (!gameStarted) {
                alert("Please start the game first!");
                return;
            }

            const row = parseInt(event.target.dataset.row);
            const col = parseInt(event.target.dataset.col);

            if (event.target.classList.contains("revealed")) {
                // Cell is already revealed, do nothing
                return;
            }

            if (mines.some(mine => mine.row === row && mine.col === col)) {
                event.target.classList.add("mine");
                const mineImage = document.createElement("img");
                mineImage.src = "Logo/Bomb2.png";
                mineImage.alt = "Mine";
                mineImage.classList.add("revealed");
                event.target.appendChild(mineImage);
                alert("Game Over! You hit a mine. Your score: " + points);
                resetGame();
            } else {
                event.target.classList.add("revealed");
                event.target.style.backgroundColor = "#000000"; // Change background color
                const safeImage = document.createElement("img");
                safeImage.src = "Logo/Chip_gr√∏nn.png";
                safeImage.alt = "Safe";
                safeImage.classList.add("revealed");
                event.target.appendChild(safeImage);
                points++;

                if (points === gridSize * gridSize - numMines) {
                    alert("Congratulations! You've won! Your score: " + points);
                    resetGame();
                }
            }
        }

        function resetGame() {
            gameStarted = false; // Reset the game flag
            document.getElementById("startButton").disabled = false; // Enable the "Start Game" button
            document.getElementById("container").innerHTML = "";
            mines = [];
            points = 0;
            initializeGame();
        }



        initializeGame();
    </script>
    <script>

        includeHTML();

    </script>



</body>

</html>